<% if @page %>


<%=raw @page %>

<style>
  .chicken {
    background-color: red!important;
  }
  .sandwich, .chicken.sandwich {
    background-color: yellow!important;
  }
</style>

<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
<script>
var potato;
jq111 = jQuery.noConflict(true);

// must be on load unfortunately....
jq111(window).load(function(){
  // use mouseover because fires more when child goes to parent
  jq111('*:not(body, script, style)').on("mouseover", function(event){
    jq111(potato).removeClass('chicken');
    var text = jq111(this).text();
    contents = jq111(this).contents();

    // make sure that at least the children have text
    if (text.trim() != '') {
      var hasText = false;
      // making sure this thing actually does contain text
      for (var i = 0; i < contents.length; i++)
      {
        // is it a text node?  and also not just whitespace?
        if (contents[i].nodeType == 3 && contents[i].nodeValue.trim() != ''){
          hasText = true;
          break;
        }
      }
      if (hasText)
      {
        potato = this;
        jq111(this).addClass('chicken');
        event.stopPropagation()
      }
    }
  });
  // use mouseover because fires more when child goes to parent
  jq111('*:not(body, script, style)').on("click", function(event){
    event.preventDefault();
    jq111(potato).removeClass('chicken');
    var text = jq111(this).text();
    contents = jq111(this).contents();

    // make sure that at least the children have text
    if (text.trim() != '') {
      var hasText = false;
      // making sure this thing actually does contain text
      for (var i = 0; i < contents.length; i++)
      {
        // is it a text node?  and also not just whitespace?
        if (contents[i].nodeType == 3 && contents[i].nodeValue.trim() != ''){
          hasText = true;
          break;
        }
      }
      // validates whether it is a price
      if (hasText && text.replace(/\s/g, "").search(/^\$?\d+(,\d{3})*(\.\d*)?$/) != -1)
      {
        potato = this;
        jq111(this).addClass('chicken');
        jq111(this).addClass('sandwich');
        alert("Is the price " + text.replace(/\s/g, "") + "?");
        event.stopPropagation()
      }
    }

    // var text = $(this).text()
    // // not empty and looks like money.  
    // if text.trim() != '' && text.replace(/\s/g, "").search(/^\$?\d+(,\d{3})*(\.\d*)?$/) != -1
    // {
    //   // if parent has text node AND is also valid, then there must be more digits...abort!

    //   // must contain at least some of the text
    //   var contents = $(this).contents();
    //   var doesContain = false;
    //   for (var i = 0; i < contents.length; i++)
    //   {
    //     // is it a text node?  and also not just whitespace?
    //     if (contents[i].nodeType == 3 && contents[i].nodeValue.trim() == '')
    //       doesContain = true;
    //   }
    // }
  });
});
</script>
<% else %>

scraper.html.erb
<%= form_tag("/scraper", method: "get") do %>
  <%= label_tag(:url, "Search for:") %>
  <%= text_field_tag(:url) %>
  <%= submit_tag("Search") %>
<% end %>

<% end %>